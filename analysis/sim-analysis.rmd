---
title: "GCI Impact Simulated"
author: "David Ferreira Quaresma (david.quaresma@ccc.ufcg.edu.br)"
date: "october, 2019"
output: pdf_document
---

# Pergunta geral: qual o impacto do GCI quando utilizado no contexto de computação serverless?
## Em relação ao tempo de resposta e throughput: a fim de evitar o impacto do coletor de lixo, há melhoria no tempo de resposta mesmo ao submeter uma requisição a possíveis vários redirecionamentos e um cold-start?
Apesar de não se ter notado impacto no throughput durante as simulações, notou-se um impacto positivo do GCI, contribuindo para um melhor valor de tempo de resposta nos percentils não afetados por coldstart. 
No caso do escalonador normal, a redução do tempo de serviço quando utilizado o GCI chega até 10% no percentil 99.9. No caso do escalonador ótimo para provisionamento não ciente do GCI, utilizar o GCI diminui o tempo de resposta em até 22% no percentil 99.99. Por fim, no caso do escalonador ótimo considerando a presença do GCI, fazer uso do GCI diminui o tempo de resposta em até 32% no percentil 99.99.

## Em relação à eficiência: a fim de evitar o impacto do coletor de lixo, há prejuízo no uso eficiente dos recursos computacionais ao levantar novas instâncias para dar suporte às redistribuições de requisições?
Como esperado, o cenário com escalonador normal, quando comparado aos demais escalonadores, possui o maior custo e menor eficiência dos recursos, tanto para com GCI quanto sem ele. Se compararmos para este escalonador a configuração com GCI e sem GCI, notamos que o GCI aumenta o custo e em 4% e aumenta a eficiência em aproximadamente 13%.
Com relação ao cenário utilizando GCI e os escalonadores ótimos, não conseguimos observar variança significativa com relação ao custo e eficiência. Contudo, Podemos notar que houve um impacto negativo do GCI quando comparado ao caso ótimo sem GCI, onde o aumento no custo foi de aproximadamente 12% e a redução da eficiência foi de aproximadamente 26%.

# Simulation results: GCI vs NOGCI
```{r echo=FALSE, results='hide', message=FALSE}
source("functions.R")
sim_result_path = "../simulation/results/"
gci_normscheduler   = data.frame()
gci_opscheduler     = data.frame()
gci_opgcischeduler  = data.frame()
nogci_normscheduler = data.frame()
nogci_opscheduler   = data.frame()
for(i in 1:5){
  gci_normscheduler   = rbind(gci_normscheduler, filter(read.al.sim(paste(sim_result_path, "sim-pp-gci", as.character(i),   "-normscheduler-reqs",  ".csv", sep="")), status == 200))
  gci_opscheduler     = rbind(gci_opscheduler, filter(read.al.sim(paste(sim_result_path, "sim-pp-gci", as.character(i),   "-opscheduler-reqs",    ".csv", sep="")), status == 200))
  gci_opgcischeduler  = rbind(gci_opgcischeduler, filter(read.al.sim(paste(sim_result_path, "sim-pp-gci", as.character(i),   "-opgcischeduler-reqs", ".csv", sep="")), status == 200))
  nogci_normscheduler = rbind(nogci_normscheduler, filter(read.al.sim(paste(sim_result_path, "sim-pp-nogci", as.character(i), "-normscheduler-reqs",  ".csv", sep="")), status == 200))
  nogci_opscheduler   = rbind(nogci_opscheduler, filter(read.al.sim(paste(sim_result_path, "sim-pp-nogci", as.character(i), "-opscheduler-reqs",    ".csv", sep="")), status == 200))
}
gci_normscheduler$response_time   = gci_normscheduler$response_time * 1000
gci_opscheduler$response_time     = gci_opscheduler$response_time * 1000
gci_opgcischeduler$response_time  = gci_opgcischeduler$response_time * 1000
nogci_normscheduler$response_time = nogci_normscheduler$response_time * 1000
nogci_opscheduler$response_time   = nogci_opscheduler$response_time * 1000
```

#### ECDF for response time of all simulation
```{r  fig.width=15, fig.height=5, echo=FALSE}
tecdf_nsched     = "ECDF RESPONSE TIME - NORM SCHEDULER"
tecdf_opsched    = "ECDF RESPONSE TIME - OP SCHEDULER"
tecdf_opgcisched = "ECDF RESPONSE TIME - OP GCI SCHEDULER"
graph_tail(gci_normscheduler$response_time,  nogci_normscheduler$response_time, c("GCI", "NOGCI"),     title=tecdf_nsched, x_limit_sup=100)
graph_tail(gci_opscheduler$response_time,   nogci_opscheduler$response_time,  c("GCI", "NOGCI"),    title=tecdf_opsched, x_limit_sup=100)
graph_tail(gci_opgcischeduler$response_time, nogci_opscheduler$response_time, c("GCI", "NOGCI"), title=tecdf_opgcisched, x_limit_sup=100)
```

#### summary table of confidence interval for response time, both in milliseconds, of all simulation
```{r  fig.width=15, fig.height=5, echo=FALSE}
summary_table( gci_normscheduler$response_time, "gci", nogci_normscheduler$response_time, "nogci")
summary_table(   gci_opscheduler$response_time, "gci",   nogci_opscheduler$response_time, "nogci")
summary_table(gci_opgcischeduler$response_time, "gci",   nogci_opscheduler$response_time, "nogci")
```

#### comparison table for response time, of all simulation
```{r  fig.width=15, fig.height=5, echo=FALSE}
quantiles_dataframe_comparison(nogci_normscheduler$response_time,  gci_normscheduler$response_time)
quantiles_dataframe_comparison(nogci_opscheduler$response_time,      gci_opscheduler$response_time)
quantiles_dataframe_comparison(nogci_opscheduler$response_time,   gci_opgcischeduler$response_time)
```

#### Visualizing metrics
```{r  fig.width=15, fig.height=5, echo=FALSE}
source("functions.R")
sim_result_path = "../simulation/results/"
gci_normscheduler   = c(  "gci",  "normscheduler", 0, 0, 0, 0)
gci_opscheduler     = c(  "gci",    "opscheduler", 0, 0, 0, 0)
gci_opgcischeduler  = c(  "gci", "opgcischeduler", 0, 0, 0, 0)
nogci_normscheduler = c("nogci",  "normscheduler", 0, 0, 0, 0)
nogci_opscheduler   = c("nogci",    "opscheduler", 0, 0, 0, 0)
mean_at_i <- function(i, a, b) {
  a = as.double(a)
  return( ((i - 1) * a + b) / i )
}
for(i in 1:5){
  simi_metrics = read.al.sim(paste(sim_result_path, "sim", as.character(i), "-metrics.csv", sep=""))
  gcii_normscheduler   = filter(filter(simi_metrics, scenario == paste(  "pp-gci", as.character(i), sep="")), scheduler_name == "-normscheduler")
  gcii_opscheduler     = filter(filter(simi_metrics, scenario == paste(  "pp-gci", as.character(i), sep="")), scheduler_name == "-opscheduler")
  gcii_opgcischeduler  = filter(filter(simi_metrics, scenario == paste(  "pp-gci", as.character(i), sep="")), scheduler_name == "-opgcischeduler")
  nogcii_normscheduler = filter(filter(simi_metrics, scenario == paste("pp-nogci", as.character(i), sep="")), scheduler_name == "-normscheduler")
  nogcii_opscheduler   = filter(filter(simi_metrics, scenario == paste("pp-nogci", as.character(i), sep="")), scheduler_name == "-opscheduler")

  gci_normscheduler[3]   = mean_at_i(i, gci_normscheduler[3], gcii_normscheduler$throughput)
  gci_opscheduler[3]     = mean_at_i(i, gci_opscheduler[3], gcii_opscheduler$throughput)
  gci_opgcischeduler[3]  = mean_at_i(i, gci_opgcischeduler[3], gcii_opgcischeduler$throughput)
  nogci_normscheduler[3] = mean_at_i(i, nogci_normscheduler[3], nogcii_normscheduler$throughput)
  nogci_opscheduler[3]   = mean_at_i(i, nogci_opscheduler[3], nogcii_opscheduler$throughput)

  gci_normscheduler[4]   = mean_at_i(i, gci_normscheduler[4], gcii_normscheduler$instances_cost)
  gci_opscheduler[4]     = mean_at_i(i, gci_opscheduler[4], gcii_opscheduler$instances_cost)
  gci_opgcischeduler[4]  = mean_at_i(i, gci_opgcischeduler[4], gcii_opgcischeduler$instances_cost)
  nogci_normscheduler[4] = mean_at_i(i, nogci_normscheduler[4], nogcii_normscheduler$instances_cost)
  nogci_opscheduler[4]   = mean_at_i(i, nogci_opscheduler[4], nogcii_opscheduler$instances_cost)

  gci_normscheduler[5]   = mean_at_i(i, gci_normscheduler[5], gcii_normscheduler$instances_efficiency)
  gci_opscheduler[5]     = mean_at_i(i, gci_opscheduler[5], gcii_opscheduler$instances_efficiency)
  gci_opgcischeduler[5]  = mean_at_i(i, gci_opgcischeduler[5], gcii_opgcischeduler$instances_efficiency)
  nogci_normscheduler[5] = mean_at_i(i, nogci_normscheduler[5], nogcii_normscheduler$instances_efficiency)
  nogci_opscheduler[5]   = mean_at_i(i, nogci_opscheduler[5], nogcii_opscheduler$instances_efficiency)

  gci_normscheduler[6]   = mean_at_i(i, gci_normscheduler[6], gcii_normscheduler$simulation_exec_time)
  gci_opscheduler[6]     = mean_at_i(i, gci_opscheduler[6], gcii_opscheduler$simulation_exec_time)
  gci_opgcischeduler[6]  = mean_at_i(i, gci_opgcischeduler[6], gcii_opgcischeduler$simulation_exec_time)
  nogci_normscheduler[6] = mean_at_i(i, nogci_normscheduler[6], nogcii_normscheduler$simulation_exec_time)
  nogci_opscheduler[6]   = mean_at_i(i, nogci_opscheduler[6], nogcii_opscheduler$simulation_exec_time)
}
take_col_i <- function(i) {return (c(gci_normscheduler[i], gci_opscheduler[i], gci_opgcischeduler[i], nogci_normscheduler[i], nogci_opscheduler[i]))}
scenario = take_col_i(1)
scheduler_name = take_col_i(2)
throughput = take_col_i(3)
instances_cost = take_col_i(4)
instances_efficiency = take_col_i(5)
simulation_exec_time = take_col_i(6)
data.frame(scenario,scheduler_name,throughput,instances_cost,instances_efficiency,simulation_exec_time)
```
